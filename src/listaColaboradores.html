<!DOCTYPE html>
<html lang="pt-br">

<head>
    <title>Colaboradores</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <div id="reusohead">
    </div>

</head>

<body>
    <header>
        <!-- Início código NavBar -->
        <div id="reusonavbar">

        </div>
        <!-- Fim da NavBar -->

        <!-- Início do código do início do site -->

        <h1 style="text-align:center"> Colaboradores </h1>
        <br>
        <!-- Search box -->
        <div class="input-group row col-md-6 offset-3">
            <input type="search" class="form-control rounded"
                placeholder="Digite aqui para procurar os dados de um colaborador" aria-label="Search"
                aria-describedby="search-addon" />
            <button type="button" class="btn" style="background-color:#167bce;color:whitesmoke">Procurar</button>
        </div>
    </header>


    <br>
    <div class="d-flex justify-content-center">
        <div class="formulariopesq justify-itens">
            <div id="main"></div>

        </div>
    </div>
    <br>

    <!-- Fim do código do início do site -->


    <div id="reusofooter">

    </div>

    <script>
        $(document).ready(function () {
            $("#reusohead").load("reuso/head.html");
            $("#reusonavbar").load("reuso/navbar.html");
            $("#reusofooter").load("reuso/footer.html");
        })
    </script>

    <script>
        api = 'http://127.0.0.1:3022'


        $(document).ready(() => {
            colaboradores.list();
        });



        /*function inserirColaborador() {

            const nomeColab = document.getElementsByName('NomeColab').value;


            var settings = {
                "url": "http://127.0.0.1:3022/insertColaborador",
                "method": "POST",
                "timeout": 0,
                "data": {

                    "nomeColab": nomeColab,

                }
            };

            $.ajax(settings).done(response => {
                console.log(response)
            });
        } */


        var colaboradores = {

            list() {
                $.ajax({
                    url: 'http://127.0.0.1:3022/readColaborador',
                    type: 'GET',
                    success: data => {
                        data.forEach(element => {
                            //     const tr = document.createElemenet("tr");
                            //     tr.innerHTML = `
                            //     <tr>
                            //         <th scope="row">${element.NomeColab} </th>
                            //     <tr>`
                            // })
                            var tx = '';
                            tx += '<div class="insert" onclick="colaborador.insert()">Inserir</div>';
                            data.forEach(element => {
                                tx += '<div class="user">';
                                tx += `<div style="display: inline-block;"> ${element.Nome} | ${element.CPF} | ${element.Tipo} | ${element.Senha} | ${element.Endereco} | ${element.Data} | ${element.PrimeiroAcesso} | ${element.UltimoAcesso}`;
                                tx += '<div class="actions">';
                                tx += '<div class="action" onclick="colaborador.update(' + element.CPF + ',\'' + element.Nome + '\')">Editar</div>';
                                tx += '<div class="action" onclick="colaborador.delete(' + element.CPF + ')">Excluir</div></div></div></div>';
                            });
                            $('#main').html(tx);
                            // main.appendChild(tx);
                        })
                    }
                });


            }

        };

        var colaborador = {

            insert() {
                var NomeColab = prompt('Digite o nome:');
                var CPFColab = prompt('Digite o CPF:');
                var TipoColab = 'fodido';
                if (CPFColab) {
                    console.log("passei pelo if pq existe cpf")
                    $.ajax({
                        type: 'POST',
                        url: api + '/insertColaborador',
                        data: {
                            NomeColab: `${NomeColab}`,
                            CPFColab: `${CPFColab}`,
                            TipoColab: `${TipoColab}`,
                        },
                    }).done(function () {
                        colaboradores.list();
                        console.log("Chamei o user.list dps do insert");
                    }).fail(function (msg) {
                        console.log("deu ruim aqui");
                    });
                    console.log("será que rodou o ajax?")
                }
            },

            update(CPFColab, oldTitle) {

                var NomeColab = prompt('Digite o novo nome:', oldTitle);
                if (NomeColab) {
                    if (NomeColab.trim() != '') {
                        $.ajax({
                            type: 'POST',
                            url: api + '/updateColaborador',
                            data: {
                                NomeColab: NomeColab,
                                CPFColab: CPFColab
                            },
                        }).done(function () {
                            colaboradores.list();
                        }).fail(function (msg) {
                            //console.log('FAIL');
                        }).always(function (msg) {
                            //console.log('ALWAYS');
                        });
                    }
                }
            },

            delete(CPFColab) {

                if (confirm('Confirma a exclusão?')) {
                    $.ajax({
                        type: 'POST',
                        url: api + '/deleteColaborador',
                        data: { CPFColab: CPFColab },
                    }).done(function () {
                        colaboradores.list();
                    }).fail(function (msg) {
                        //console.log('FAIL');
                    }).always(function (msg) {
                        //console.log('ALWAYS');
                    });
                }
            }

        } 
    </script>
</body>

</html>