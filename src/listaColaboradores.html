<!DOCTYPE html>
<html lang="pt-br">

<head>
    <title>Colaboradores</title>
    <div id="reusohead">

    </div>
    <!-- reuso -->
    <script src="https://code.jquery.com/jquery-3.3.1.js"
        integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous">
        </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

</head>

<body>
    <header>
        <!-- Início código NavBar -->
        <div id="reusonavbar">

        </div>

        <!-- Fim da NavBar -->
        <!-- Início do código do início do site -->

        <h1 style="text-align:center"> Colaboradores </h1>
        <br>
        <!-- Search box -->
        <div class="input-group row col-md-6 offset-3">
            <input type="search" class="form-control rounded"
                placeholder="Digite aqui para procurar os dados de um colaborador" aria-label="Search"
                aria-describedby="search-addon" />
            <button type="button" class="btn" style="background-color:#167bce;color:whitesmoke">Procurar</button>
        </div>
    </header>


    <br>
    <div class="d-flex justify-content-center">
        <div class="formulariopesq justify-itens">
            <script>
                api = 'http://127.0.0.1:3022'


                $(document).ready(() => {
                    users.list();
                });


                var users = {

                    list() {
                        $.ajax({
                            url: api + '/readColaborador',
                            type: 'GET',
                            success: data => {
                                var tx = '';
                                tx += '<div class="insert" onclick="user.insert()">Inserir</div>';
                                data.forEach(element => {
                                    tx += '<div class="user">';
                                    tx += '<div class="title">' + element.title + '</div>';
                                    tx += '<div class="actions">';
                                    tx += '<div class="action" onclick="user.update(' + element.userId + ',\'' + element.title + '\')">Editar</div>';
                                    tx += '<div class="action" onclick="user.delete(' + element.userId + ')">Excluir</div>';
                                    tx += '</div>';
                                    tx += '</div>';
                                });
                                $('#main').html(tx);
                            }
                        });

                    }

                };

                var user = {

                    insert() {
                        var title = prompt('Digite o nome:');
                        if (title) {
                            if (title.trim() != '') {
                                $.ajax({
                                    type: 'POST',
                                    url: api + '/insertColaborador',
                                    data: { title: title },
                                }).done(function () {
                                    users.list();
                                }).fail(function (msg) {
                                    //console.log('FAIL');
                                }).always(function (msg) {
                                    //console.log('ALWAYS');
                                });
                            }
                        }
                    },


                    update(userId, oldTitle) {

                        var title = prompt('Digite o novo nome:', oldTitle);
                        if (title) {
                            if (title.trim() != '') {
                                $.ajax({
                                    type: 'POST',
                                    url: api + '/updateColaborador',
                                    data: { title: title, userId: userId },
                                }).done(function () {
                                    users.list();
                                }).fail(function (msg) {
                                    //console.log('FAIL');
                                }).always(function (msg) {
                                    //console.log('ALWAYS');
                                });
                            }
                        }
                    },

                    delete(userId) {

                        if (confirm('Confirma a exclusão?')) {
                            $.ajax({
                                type: 'POST',
                                url: api + '/deleteColaborador',
                                data: { userId: userId },
                            }).done(function () {
                                users.list();
                            }).fail(function (msg) {
                                //console.log('FAIL');
                            }).always(function (msg) {
                                //console.log('ALWAYS');
                            });
                        }
                    },

                }
            </script>
        </div>
    </div>
    <br>

    <!-- Fim do código do início do site -->


    <div id="reusofooter">

    </div>

    <script>
        $(document).ready(function () {
            $("#reusohead").load("reuso/head.html");
            $("#reusonavbar").load("reuso/navbar.html");
            $("#reusofooter").load("reuso/footer.html");
        })
    </script>
</body>

</html>